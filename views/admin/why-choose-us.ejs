<%- include("navbar.ejs") %>

  <div class="container py-4">

    <!-- Buttons Row -->
    <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-2">

      <!-- Left: Add Button -->
      <button class="btn btn-primary" data-bs-toggle="collapse" data-bs-target="#addTreatmentForm">
        <i class="fas fa-plus me-1"></i> Add Why Choose Us
      </button>

      <!-- Right: CSV + Print -->
      <div class="d-flex gap-2">
        <button onclick="exportWhychooseusCSV()" class="btn btn-success">
          <i class="fas fa-file-csv me-2"></i> Export CSV
        </button>

        <button onclick="printWhychooseus()" class="btn btn-secondary">
          <i class="fas fa-print me-1"></i> Print
        </button>
      </div>

    </div>


    <!-- Collapse Form -->
    <div class="collapse" id="addTreatmentForm">
      <div class="card shadow-sm border-0">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">Add New Why Choose Us</h5>
        </div>

        <div class="card-body">
          <form action="/admin/save-why-choose-us" method="POST">

            <!-- Row 1 -->
            <div class="row mb-3">
              <div class="col-md-6">
                <label for="whychooseus_name" class="form-label">Title*</label>
                <input type="text" name="whychooseus_name" class="form-control" id="whychooseus_name"
                  placeholder="Enter Title" autocomplete="off" required>
              </div>

              <div class="col-md-6">
                <label for="whychooseus_icon" class="form-label">Icon*</label>
                <select name="whychooseus_icon" class="form-control" id="whychooseus_icon" required>
                  <option value="" disabled selected>--Select Icon--</option>
                  <option value="fas fa-chart-line">Chart Line</option>
                  <option value="fas fa-microscope">Laboratory</option>
                  <option value="fas fa-user-md">Team</option>
                  <option value="fas fa-heart">Heart</option>

                </select>
              </div>
            </div>

            <!-- Row 2 -->
            <div class="row mb-3">
              <div class="col-md-12">
                <label for="whychooseus_desc" class="form-label">Description*</label>
                <textarea name="whychooseus_desc" class="form-control" id="whychooseus_desc" rows="4"
                  placeholder="Enter Description" required></textarea>
              </div>
            </div>

            <!-- Submit -->
            <div class="text-end">
              <button type="submit" class="btn btn-success px-4">
                <i class="fas fa-save me-1"></i> Save Why Choose Us
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="container" id="printArea">
    <div class="row">
      <div class="col-md-12">
        <table class="table table-bordered table-striped">
          <thead>
            <tr>
              <th>Sr.No.</th>
              <th>Title</th>
              <th>Icon</th>
              <th>Description</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% for (var i=0; i < whychooseus_info.length; i++) { %>
              <tr>
                <td>
                  <%= i + 1 %>
                </td>
                <td>
                  <%= whychooseus_info[i].whychooseus_name %>
                </td>
                <td><i class="<%= whychooseus_info[i].whychooseus_icon %> text-primary"></i></td>
                <td>
                  <%= whychooseus_info[i].whychooseus_desc %>
                </td>
                <td>
                  <a href="/admin/edit-why-choose-us/<%= whychooseus_info[i].whychooseus_id %>" type="button"
                    class="btn btn-warning btn-sm"><i class="bi bi-pencil"></i></a>
                  <a href="/admin/delete-why-choose-us/<%= whychooseus_info[i].whychooseus_id %>" type="button"
                    onclick="return confirm('Are you sure you want to delete this Why Choose Us?')"
                    class="btn btn-danger btn-sm"><i class="bi bi-trash"></i></a>
                </td>
              </tr>
              <% } %>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    function exportWhychooseusCSV() {
      let csv = [];
      let table = document.querySelector("#printArea table");
      if (!table) {
        alert("Table not found!");
        return;
      }
      let rows = table.querySelectorAll("tr");
      rows.forEach(rowEl => {
        let row = [];
        let cols = rowEl.querySelectorAll("th, td");
        cols.forEach((col, index) => {
          if (index === 1 || index === 6) return;
          let text = col.innerText.trim().replace(/"/g, '""');
          row.push(`"${text}"`);
        });
        if (row.length > 0) {
          csv.push(row.join(","));
        }
      });
      let csvContent = "\uFEFF" + csv.join("\n");
      let blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
      let link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "whychooseus_list.csv";
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
  </script>




  <script>
    function printWhychooseus() {
      const printContent = document.getElementById("printArea").innerHTML;
      const originalContent = document.body.innerHTML;

      document.body.innerHTML = printContent;
      window.print();

      setTimeout(() => {
        document.body.innerHTML = originalContent;
      }, 1000);
    }

  </script>


  <%- include("footer.ejs") %>