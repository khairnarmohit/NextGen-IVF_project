
<%- include('navbar.ejs') %>



<div class="container my-5">
  <h2 class="mb-4">Manage FAQs</h2>

  

  <!-- Buttons side by side -->
  <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">

  <!-- Left Buttons -->
  <div class="d-flex gap-2">
    <button class="btn btn-primary" type="button"
      data-bs-toggle="collapse" data-bs-target="#faqTypeForm"
      aria-expanded="false" aria-controls="faqTypeForm">
      Add FAQ Type
    </button>

    <button class="btn btn-success" type="button"
      data-bs-toggle="collapse" data-bs-target="#faqForm"
      aria-expanded="false" aria-controls="faqForm">
      Add FAQ
    </button>
  </div>

  <!-- Right Buttons (float-end style) -->
  <div class="d-flex gap-2">
    <button onclick="exportFaq()" class="btn btn-success">
      <i class="fas fa-file-csv me-2"></i> Export CSV
    </button>

    <button onclick="printFaq()" class="btn btn-secondary">
      <i class="fas fa-print me-1"></i> Print
    </button>
  </div>

</div>


  <!-- FAQ Type Form -->
  <div class="collapse" id="faqTypeForm">
    <div class="card card-body mb-3">
      <form action="/admin/save_faq_type" method="POST">
        <div class="mb-3">
          <label for="faqService" class="form-label">FAQ Service Name</label>
          <input type="text" class="form-control" id="faqService" name="faq_service" placeholder="Enter FAQ Service" required>
        </div>
        <button type="submit" class="btn btn-primary">Save FAQ Type</button>
      </form>
    </div>
  </div>

  <!-- FAQ Form -->
  <div class="collapse" id="faqForm">
    <div class="card card-body mb-3">
      <form action="/admin/save_faq" method="POST">
        <div class="mb-3">
         <label for="faqTypeSelect" class="form-label">Select FAQ Type</label>
<select class="form-select" id="faqTypeSelect" name="faq_type_id" required>
  <option value="">-- Choose Type --</option>
  <% faqTypes.forEach(type => { %>
    <option value="<%= type.faq_type_id %>">
      <%= type.faq_service %>
    </option>
  <% }) %>
</select>


        </div>
        <div class="mb-3">
          <label for="faqTitle" class="form-label">FAQ Title</label>
          <input type="text" class="form-control" id="faqTitle" name="faq_title" placeholder="Enter FAQ Title" required>
        </div>
        <div class="mb-3">
          <label for="faqDesc" class="form-label">FAQ Description</label>
          <textarea class="form-control" id="faqDesc" name="faq_desc" rows="4" placeholder="Enter FAQ Description" required></textarea>
        </div>
        <button type="submit" class="btn btn-success">Save FAQ</button>
      </form>
    </div>
  </div>

</div>
<!-- FAQ List Table -->

<div class="container-fluid" id="printArea">
  <h2 class="text-primary bg-primary text-white">FAQ List</h2>

 
<div class="container-fluid">
  <h2 class="text-primary">FAQ List</h2>
   

  <div class="row">
<div class="col-12">

<table class="table table-bordered  ">
  <thead >
    <tr>
      <th>ID</th>
      <th>FAQ Type</th>
      <th>Title</th>
      <th>Description</th>
      <th>Actions</th>
    </tr>
  </thead>
<tbody>
  <% if (faqs && faqs.length > 0) { %>
    
    <% for (let i = 0; i < faqs.length; i++) { 
    %>
      <tr>
        <td><%= i + 1 %></td>

        <td><%= faqs[i].faq_service %></td>
        <td>
  <%= faqs[i].faq_title.length > 20 
        ? faqs[i].faq_title.substring(0, 20) + '...' 
        : faqs[i].faq_title %>
</td>

       <td>
  <%= faqs[i].faq_desc.length > 30
        ? faqs[i].faq_desc.substring(0, 30) + '...'
        : faqs[i].faq_desc %>
</td>

        <td>
          <a href="/admin/edit_faq/<%= faqs[i].faq_id %>" 
             class="btn btn-sm btn-primary"><i class="bi bi-pencil"></i>
             
          </a>
         

          <a href="/admin/delete_faq/<%= faqs[i].faq_id %>" 
             class="btn btn-sm btn-danger"
             onclick="return confirm('Are you sure you want to delete this FAQ?');">
             <i class="bi bi-trash"></i>
          </a>
        </td>
      </tr>
    <% } %>

  <% } else { %>
    <tr>
      <td colspan="5" class="text-center text-muted">
        No FAQs found
      </td>
    </tr>
  <% } %>
</tbody>

</table>
</div>
</div>
</div>

 <script>
function exportFaq() {
  let csv = [];
  let table = document.querySelector("#printArea table");

  if (!table) {
    alert("Table not found!");
    return;
  }

  let rows = table.querySelectorAll("tr");

  rows.forEach(rowEl => {
    let row = [];
    let cols = rowEl.querySelectorAll("th, td");

    cols.forEach((col, index) => {
      // âŒ Skip Actions column (index 4)
      if (index === 4) return;

      let text = col.innerText
        .trim()
        .replace(/"/g, '""')
        .replace(/\n/g, ' ');

      row.push(`"${text}"`);
    });

    if (row.length > 0) {
      csv.push(row.join(","));
    }
  });

  let csvContent = "\uFEFF" + csv.join("\n");
  let blob = new Blob([csvContent], {
    type: "text/csv;charset=utf-8;"
  });

  let link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "faq_list.csv";
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}
</script>




<script>
function printFaq() {
  const printArea = document.getElementById("printArea");
  const originalBody = document.body.innerHTML;

  // Clone print area
  const clone = printArea.cloneNode(true);

  // Remove Actions column (last column)
  const rows = clone.querySelectorAll("tr");
  rows.forEach(row => {
    if (row.cells.length > 0) {
      row.deleteCell(row.cells.length - 1);
    }
  });

  // Print only modified content
  document.body.innerHTML = "";
  document.body.appendChild(clone);

  window.print();

  // Restore original page
  document.body.innerHTML = originalBody;
  location.reload();
}
</script>






 



<%- include('footer.ejs') %>
