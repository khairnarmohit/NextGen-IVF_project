<%- include("navbar.ejs") %>

<div class="container mt-4">
    
    <div class="d-flex justify-content-between align-items-center mb-3">
        
        <div>
            <% if(editData) { %>
                <a href="/admin/terms" class="btn btn-primary">
                    <i class="fas fa-plus me-2"></i>Add More Terms
                </a>
            <% } else { %>
                <button type="button" class="btn btn-primary" data-bs-toggle="collapse" data-bs-target="#addTermsCollapse">
                    <i class="fas fa-plus me-2"></i>Add More Terms
                </button>
            <% } %>
        </div>


        <div>
            <button onclick="exportTermCSV()" class="btn btn-success me-2">
                <i class="fas fa-file-csv me-2"></i>Export CSV
            </button>
            <button onclick="printterm()" class="btn btn-secondary">
                <i class="fas fa-print me-2"></i>Print
            </button>
        </div>
    </div>



    <div class="collapse mb-4 <%= editData ? 'd-none' : '' %>" id="addTermsCollapse">
        <div class="card shadow-sm border-primary">
            <div class="card-header bg-primary text-white">
                <h6 class="mb-0"><i class="fas fa-file-contract me-2"></i>Add New Term Section</h6>
            </div>
            <div class="card-body">
                <form action="/admin/terms/save" method="post">
                    <div class="mb-3">
                        <label class="form-label fw-bold">Section Title</label>
                        <input type="text" class="form-control" name="term_title" placeholder="e.g. Introduction" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">Description / Content</label>
                        <textarea class="form-control" name="term_desc" rows="6" placeholder="Enter detailed terms..." required></textarea>
                    </div>
                    <div class="text-end">
                        <button type="submit" class="btn btn-success"><i class="fas fa-save me-2"></i>Save Section</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <% if(editData) { %>
        <div class="card shadow-sm border-primary mb-4">
            <div class="card-header bg-primary text-dark">
                <h6 class="mb-0"><i class="fas fa-edit me-2"></i>Edit Term Section</h6>
            </div>
            <div class="card-body">
                <form action="/admin/terms/update" method="post">
                    <input type="hidden" name="term_id" value="<%= editData.term_id %>">
                    <div class="mb-3">
                        <label class="form-label fw-bold">Section Title</label>
                        <input type="text" class="form-control" name="term_title" value="<%= editData.term_title %>" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">Description / Content</label>
                        <textarea class="form-control" name="term_desc" rows="6" required><%= editData.term_desc %></textarea>
                    </div>
                    <div class="text-end">
                        <a href="/admin/terms" class="btn btn-secondary me-2">Cancel</a>
                        <button type="submit" class="btn btn-success text-white"><i class="fas fa-save me-2"></i>Update Section</button>
                    </div>
                </form>
            </div>
        </div>
    <% } %>


    <div id="printArea">
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Terms & Conditions List</h5>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-bordered table-hover align-middle mb-0">
                        <thead class="table-light">
                            <tr>
                                   <th style="width: 5%;" class="text-center">#</th>
                                <th class="ps-4" style="width: 20%;">Title</th>
                                <th style="width: 55%;">Description</th>
                                <th class="text-end pe-4" style="width: 10%;">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% if(list.length > 0) { %>
                                <% for (let i = 0; i < list.length; i++) { %>
                                    <tr>
                                        <td class="ps-4">
                                            <h6 class="mb-0 fw-bold text-primary"><%= i+1 %></h6>
                                        </td>
                                        <td class="ps-4">
                                            <h6 class="mb-0 fw-bold text-primary"><%= list[i].term_title %></h6>
                                        </td>
                                        <td>
                                            <p class="mb-0 text-muted" style="white-space: pre-wrap;"><%= list[i].term_desc %></p>
                                        </td>
                                        <td class="text-end pe-4">
                                            <a href="/admin/terms?edit=<%= list[i].term_id %>" class="btn btn-sm btn-outline-primary me-1">
                                                <i class="fas fa-edit"></i> 
                                            </a>
                                            
                                            <a href="/admin/terms/delete/<%= list[i].term_id %>" class="btn btn-sm btn-outline-danger" onclick="return confirm('Are you sure you want to delete this section?')">
                                                <i class="fas fa-trash"></i>
                                            </a>
                                        </td>
                                    </tr>
                                <% } %>
                            <% } else { %>
                                <tr>
                                    <td colspan="3" class="text-center p-5">No terms sections found. Click "Add More Terms" to create content.</td>
                                </tr>
                            <% } %>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function exportTermCSV() {
  let csv = [];
  let rows = document.querySelectorAll("#printArea table tr");

  for (let i = 0; i < rows.length; i++) {
    let row = [], cols = rows[i].querySelectorAll("th, td");

    for (let j = 0; j < cols.length; j++) {
      if (j === 3) continue;

      let text = cols[j].innerText.replace(/"/g, '""');
      row.push('"' + text + '"');
    }
    csv.push(row.join(","));
  }

  let csvFile = new Blob([csv.join("\n")], { type: "text/csv" });
  let downloadLink = document.createElement("a");

  downloadLink.download = "term_list.csv";
  downloadLink.href = window.URL.createObjectURL(csvFile);
  downloadLink.style.display = "none";

  document.body.appendChild(downloadLink);
  downloadLink.click();
  document.body.removeChild(downloadLink);
}
</script>

<script>
  function printterm() {
    const printContent = document.getElementById("printArea").innerHTML;
    const originalContent = document.body.innerHTML;

    document.body.innerHTML = printContent;
    window.print();
    document.body.innerHTML = originalContent;
    location.reload(); 
  }
</script>

<%- include("footer.ejs") %>