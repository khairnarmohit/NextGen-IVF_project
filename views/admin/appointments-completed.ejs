<%- include('navbar.ejs') %>
<div class="d-flex gap-2 justify-content-end">
        <button onclick="exportTableToCSV('completed_appointments.csv')" class="btn btn-success">
          <i class="fas fa-file-csv me-2"></i> Export CSV
        </button>

        <button onclick="printTable()" class="btn btn-secondary">
          <i class="fas fa-print me-1"></i> Print
        </button>
      </div>


<div class="container mt-5">
<p class="mb-2 bg-primary rounded-top fw-bold p-2 fs-5 text-light"> Completed Appointments </p>



  <table class="table table-bordered mt-3" id="appointmentsTable">
    <thead>
      <tr>
        <th scope="col">#</th>
        <th scope="col">Patient Name</th>
        <th scope="col">Doctor Name</th>
        <th scope="col"> Gender</th>
        <th scope="col"> Age</th>
        <th scope="col">Phone</th>
        <th scope="col">Appointment Date</th>
        <th scope="col">Status</th>
        <!-- <th scope="col">Action</th> -->
      </tr>
    </thead>
    <tbody>
      <% appointments.forEach((appointment, index) => { %>
        <tr>
          <th scope="row"><%= index + 1 %></th>
          <td><%= appointment.patient_fullname %></td>
          <td><%= appointment.doctor_name %></td>
            <td><%= appointment.patient_gender %></td>
            <td><%= appointment.patient_age %></td>
          <td><%= appointment.patient_mobile %></td>
          <td><%= appointment.appointment_date.toDateString() %></td>
          <td class="badge text-bg-warning"><%= appointment.status %></td>

        </tr>
      <% }) %>
    </tbody>
  </table>

<script>
  function exportTableToCSV(filename) {
    let csv = [];
    const rows = document.querySelectorAll("#appointmentsTable tr");

    for (let row of rows) {
      let cols = row.querySelectorAll("th, td");
      let rowData = [];
      cols.forEach(col => {
        rowData.push('"' + col.innerText.replace(/"/g, '""') + '"');
      });
      csv.push(rowData.join(","));
    }

    const csvFile = new Blob([csv.join("\n")], { type: "text/csv" });
    const downloadLink = document.createElement("a");

    downloadLink.download = filename;
    downloadLink.href = window.URL.createObjectURL(csvFile);
    downloadLink.style.display = "none";

    document.body.appendChild(downloadLink);
    downloadLink.click();
    document.body.removeChild(downloadLink);
  }

  function printTable() {
    const printContent = document.getElementById("appointmentsTable").outerHTML;
    const win = window.open("", "", "width=900,height=650");

    win.document.write(`
      <html>
        <head>
          <title>Completed Appointments</title>
          <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
        </head>
        <body>
          <h4 class="text-center my-3">Completed Appointments</h4>
          ${printContent}
        </body>
      </html>
    `);

    win.document.close();
    win.print();
  }
</script>



<%- include('footer.ejs') %>